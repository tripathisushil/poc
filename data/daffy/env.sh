#!/bin/bash
############################################################
#Author           : Kyle Dawson
#Author email     : Kyle.Dawson@us.ibm.com
#Original Date    : 2021-08-06
#Initial Version  : v2021-12-01
############################################################
#Standard values but can be overriddn at each lower level
##########################################################
RED_TEXT=`tput setaf 1`
GREEN_TEXT=`tput setaf 2`
ORANGE_TEXT=`tput setaf 5`
BLUE_TEXT=`tput setaf 6`
YELLOW_TEXT=`tput setaf 3`
RESET_TEXT=`tput sgr0`
CHECK_MARK=`echo -e "\xE2\x9C\x94" `
X_MARK=`echo -e "\xE2\x9D\x8C" `

PROJECT_NAME=daffy
DATA_DIR=/data
SOFTWARE_INSTALLS_DIR=${DATA_DIR}/software
TEMP_DIR=${DATA_DIR}/${PROJECT_NAME}/tmp/${CLUSTER_NAME}
LOG_DIR=${DATA_DIR}/${PROJECT_NAME}/log/${CLUSTER_NAME}
OS_NAME=`uname`
DEBUG=false
SSH_KEY_FILE=~/.ssh/id_rsa
CURRENT_DATE_TIME=`date +"%Y-%m-%d"`

#DAFFY info
#####################
DAFFY_URL=http://stats.daffy-installer.com:1888
DAFFY_API=addstats
DAFFY_UNIQUE_ID=anonymous
DAFFY_VERSION=v2022-05-23a


#OS setttings
#################################################
OS=`find /etc | grep -c os-release`
if [ $OS = 1 ]; then
   IS_UBUNTU=`cat /etc/os-release | grep ID | grep -c ubuntu`
   IS_RH=`cat /etc/os-release | grep ID | grep -c rhel`
   RHEL_8_SUPPORTED=`cat /etc/os-release | grep VERSION_ID | grep -c 8.`
   if [ ${IS_UBUNTU}  -eq 1 ]; then
      LOCAL_CA_CERT_FOLDER=/usr/local/share/ca-certificates
   fi
   if [ ${IS_RH} -eq 1 ]; then
     LOCAL_CA_CERT_FOLDER=/etc/pki/ca-trust/source/anchors
   fi
fi
LOCAL_HOST_NAME=`hostname`


#OCP Settings
#################################################
OCP_HOST_NAME=${CLUSTER_NAME}.${BASE_DOMAIN}
OCP_USER="kubeadmin"
MATCHBOX_VERSION=v0.8.3
MATCHBOX_CLEANUP=true
OCP_KEEP_BOOTSTRAP=false
OCP_LOCAL_ADMIN=ocpadmin
IGNORE_OCP_INSTALL_TYPE_CHECK=false
OCP_ISO_NAME_4_6=rhcos-4.6.47-x86_64-live.x86_64.iso
OCP_ISO_NAME_4_7=rhcos-4.7.33-x86_64-live.x86_64.iso
OCP_ISO_NAME_4_8=rhcos-4.8.14-x86_64-live.x86_64.iso
OCP_ISO_NAME_4_9=rhcos-4.9.0-x86_64-live.x86_64.iso
OCP_ISO_NAME_4_10=rhcos-4.10.3-x86_64-live.x86_64.iso
OCP_CREATE_NFS_STORAGE=false
OCP_CREATE_OPENSHIFT_CONTAINER_STORAGE=false
OCP_TRUSTE_CA_NAME=custom-ca
OCP_TRUSTE_CA_FILE=lets-encrypt.crt
OCP_KUBECONFIG_DIR=/var/ibm-ocp
OCP_FIPS=false
OCP_TOOLS_CLEANUP=true
OCP_CATALOG_MIRRORS=compliance-operator,container-security-operator,file-integrity-operator,local-storage-operator,ocs-operator
PRODUCT_REPO=openshift-release-dev
RELEASE_NAME=ocp-release
ARCHITECTURE=x86_64
RUN_CSR_APPROVE_PROCESS=true
OCP_VALIDATE_VERSION_SITE=true
OPENSHIFT_SITE_DOWNLOAD=https://mirror.openshift.com
#haproxy setttings
##################################################
HAPROXY_BUILD=true

#TShirt setttings
##################################################
#Dfault Size
VM_TSHIRT_SIZE=Min
VM_BUILD_WORKERS_NODES=true

VM_BOOTSTRAP_VCPU_LARGE=2
VM_BOOTSTRAP_RAM_LARGE=8192
VM_BOOTSTRAP_DISK1_LARGE=128G

VM_NUMBER_OF_MASTERS_LARGE=3
VM_MASTER_VCPU_LARGE=8
VM_MASTER_RAM_LARGE=32768
VM_MASTER_DISK1_LARGE=128G

VM_NUMBER_OF_WORKERS_LARGE=6
VM_WORKER_VCPU_LARGE=16
VM_WORKER_RAM_LARGE=65536
VM_WORKER_DISK1_LARGE=128G
VM_WORKER_DISK2_LARGE=50G
VM_WORKER_DISK3_LARGE=200G

VM_BOOTSTRAP_VCPU_MIN=2
VM_BOOTSTRAP_RAM_MIN=8192
VM_BOOTSTRAP_DISK1_MIN=128G

VM_NUMBER_OF_MASTERS_MIN=3
VM_MASTER_VCPU_MIN=4
VM_MASTER_RAM_MIN=16384
VM_MASTER_DISK1_MIN=128G

VM_NUMBER_OF_WORKERS_MIN=3
VM_WORKER_VCPU_MIN=4
VM_WORKER_RAM_MIN=16384
VM_WORKER_DISK1_MIN=128G
VM_WORKER_DISK2_MIN=10G
VM_WORKER_DISK3_MIN=100G

OCP_OCS_STORAGE_CLASS_BLOCK=localblock-sc
OCP_OCS_STORAGE_CLASS_FILE=local-sc

#VMDashboard
#######################################
VM_DASHBOARD_ENABLED=false
VM_DASHBOARD_USER=vmdashboard
VM_DASHBOARD_DB_NAME=vmdashboard
VM_DASHBOARD_VERSION=19.01.03

#VSphere Storage
#######################################
VSPHERE_OCP_OCS_STORAGE_CLASS_BLOCK=thin
VSPHERE_OCP_OCS_STORAGE_CLASS_FILE=thin


#GCP Sizing
#######################################
#We do not control this, it will use same as your masters
GCP_MACHINE_TYPE_BOOTSTRAP_LARGE=n1-standard
GCP_MACHINE_TYPE_BOOTSTRAP_CPU_LARGE=2
GCP_MACHINE_TYPE_MASTER_LARGE=n1-standard
GCP_MACHINE_TYPE_MASTER_CPU_LARGE=8
GCP_MACHINE_TYPE_WORKER_LARGE=n1-standard
GCP_MACHINE_TYPE_WORKER_CPU_LARGE=16

#We do not control this, it will use same as your masters
GCP_MACHINE_TYPE_BOOTSTRAP_MIN=n1-standard
GCP_MACHINE_TYPE_BOOTSTRAP_CPU_MIN=2
GCP_MACHINE_TYPE_MASTER_MIN=n1-standard
GCP_MACHINE_TYPE_MASTER_CPU_MIN=4
GCP_MACHINE_TYPE_WORKER_MIN=n1-standard
GCP_MACHINE_TYPE_WORKER_CPU_MIN=4

GCP_WORKER_DISK2_TYPE=pd-ssd
GCP_WORKER_DISK3_TYPE=pd-ssd
GCP_OCP_OCS_STORAGE_CLASS_BLOCK=pd-ssd
GCP_OCP_OCS_STORAGE_CLASS_FILE=pd-ssd
GCP_CREDENTIALS_MODE=Mint


#Azure Sizing
#######################################
AZURE_VCPU_QUOTA_NAME="Standard DSv3 Family vCPUs"
#We do not control this, it will use same as your masters
#AZURE_MACHINE_TYPE_BOOTSTRAP_LARGE=Standard_D2s_v3
#AZURE_MACHINE_TYPE_BOOTSTRAP_CPU_LARGE=2
AZURE_MACHINE_TYPE_MASTER_LARGE=Standard_D8s_v3
AZURE_MACHINE_TYPE_MASTER_CPU_LARGE=8
AZURE_MACHINE_TYPE_WORKER_LARGE=Standard_D16s_v3
AZURE_MACHINE_TYPE_WORKER_CPU_LARGE=16


#We do not control this, it will use same as your masters
#AZURE_MACHINE_TYPE_BOOTSTRAP_MIN=Standard_D2s_v3
#AZURE_MACHINE_TYPE_BOOTSTRAP_CPU_MIN=2
AZURE_MACHINE_TYPE_MASTER_MIN=Standard_D4s_v3
AZURE_MACHINE_TYPE_MASTER_CPU_MIN=4
AZURE_MACHINE_TYPE_WORKER_MIN=Standard_D4s_v3
AZURE_MACHINE_TYPE_WORKER_CPU_MIN=4

AZURE_WORKER_DISK2_TYPE=StandardSSD_LRS
AZURE_WORKER_DISK3_TYPE=StandardSSD_LRS
AZURE_OCP_OCS_STORAGE_CLASS_BLOCK=managed-premium
AZURE_OCP_OCS_STORAGE_CLASS_FILE=managed-premium
AZURE_CREDENTIALS_MODE=Mint

#AWS Sizing
#######################################
AWS_USER_TAG_MAIN1="IBMInstaller: Daffy"
#We do not control this, it will use same as your masters
#AWS_MACHINE_TYPE_BOOTSTRAP_LARGE=m5.large     #Bootstrap type can not be change
#AWS_MACHINE_TYPE_BOOTSTRAP_CPU_LARGE=2        #Bootstrap CPU Count can not be change
AWS_MACHINE_TYPE_MASTER_LARGE=m4.2xlarge
AWS_MACHINE_TYPE_MASTER_CPU_LARGE=8
AWS_MACHINE_TYPE_WORKER_LARGE=m4.4xlarge
AWS_MACHINE_TYPE_WORKER_CPU_LARGE=16

#We do not control this, it will use same as your masters
#AWS_MACHINE_TYPE_BOOTSTRAP_MIN=m5.large       #Bootstrap type  can not be change
#AWS_MACHINE_TYPE_BOOTSTRAP_CPU_MIN=2          #Bootstrap CPU Count can not be change
AWS_MACHINE_TYPE_MASTER_MIN=m4.xlarge
AWS_MACHINE_TYPE_MASTER_CPU_MIN=4
AWS_MACHINE_TYPE_WORKER_MIN=m4.xlarge
AWS_MACHINE_TYPE_WORKER_CPU_MIN=4

AWS_DISK_VOLUME_TYPE=gp2
AWS_DISK_VOLUME_IOPS=1000
AWS_OCP_OCS_STORAGE_CLASS_BLOCK=gp2
AWS_OCP_OCS_STORAGE_CLASS_FILE=gp2

AWS_OCP_OCS_STORAGE_CLASS_BLOCK_SIZE=2T
AWS_OCP_OCS_STORAGE_CLASS_FILE_SIZE=1T

AWS_CREDENTIALS_MODE=Mint

#ROKS Sizing
#######################################
ROKS_FLAVOR_MIN=b3c.4x16


ROKS_FLAVOR_LARGE=b3c.16x64


#ROSA Sizing
#######################################
ROSA_FLAVOR_LARGE=m5.4xlarge
ROSA_MACHINE_TYPE_CPU_LARGE=16

ROSA_FLAVOR_MIN=m5.2xlarge
ROSA_MACHINE_TYPE_CPU_MIN=8
ROSA_BOOTSTRAP_CPU=4
ROSA_INFRA_CPU=4

ROSA_OCP_OCS_STORAGE_CLASS_BLOCK=gp2
ROSA_OCP_OCS_STORAGE_CLASS_FILE=gp2

ROSA_OCP_OCS_STORAGE_CLASS_BLOCK_SIZE=2T
ROSA_OCP_OCS_STORAGE_CLASS_FILE_SIZE=1T

#Disk Settings
##################################################
VM_IMAGE_ROOT_PATH=/var/lib/uvtool/libvirt/images/ocp
VM_VOL_STORAGE_POOL=ocp

#Cloud Pak Settings
##################################################
CP_REGISTRY=cp.icr.io
CP_REGISTRY_EMAIL=daffy-installer@ibm.com
CP_DEPLOYMENT_PLATFORM=OCP

#Network Settings
##################################################
DNSMASQ_BUILD=true
ORIGINAL_DNS_SERVERS=8.8.8.8
OCP_NET_CONNECTION_PROFILE="Wired connection 1"
OCP_FORWARD_DNS=8.8.8.8
OCP_INSTALL_DHCP_RANGE_START=192.168.10.10
OCP_INSTALL_DHCP_RANGE_STOP=192.168.10.254
if [ "${OCP_INSTALL_TYPE}"  ==  "kvm-upi" ] ;then
    OCP_INSTALL_GATEWAY=192.168.10.1
    OCP_INSTALLBOOTSTRAP_IP=192.168.10.90
    OCP_INSTALL_MASTER1_IP=192.168.10.91
    OCP_INSTALL_MASTER2_IP=192.168.10.92
    OCP_INSTALL_MASTER3_IP=192.168.10.93
    OCP_INSTALL_WORKER1_IP=192.168.10.94
    OCP_INSTALL_WORKER2_IP=192.168.10.95
    OCP_INSTALL_WORKER3_IP=192.168.10.96
    OCP_INSTALL_WORKER4_IP=192.168.10.97
    OCP_INSTALL_WORKER5_IP=192.168.10.98
    OCP_INSTALL_WORKER6_IP=192.168.10.99
    OCP_INSTALL_WORKER7_IP=192.168.10.100
    OCP_INSTALL_WORKER8_IP=192.168.10.101
    OCP_INSTALL_WORKER9_IP=192.168.10.102
fi
if [ "${OCP_INSTALL_TYPE}"  ==  "vsphere-upi" ] ;then
    OCP_INSTALL_WORKER7_IP=999.999.999.999
    OCP_INSTALL_WORKER8_IP=999.999.999.999
    OCP_INSTALL_WORKER9_IP=999.999.999.999
fi
VSPHERE_NETWORK1_INTERFACE_NAME=ens32
VSPHERE_NETWORK2_INTERFACE_NAME=ens34

##IBM Clound Info
################################
IBMCLOUD_REGION=us-south
CIS_INSTANCE_NAME=InternetServices
DNS_DOMAIN_ID=9c5fe1170abed0aafe255f39d85dcea9
IBMCLOUD_RESOURCE_GROUP=default

#KVM info
################################
KVM_IMAGE_DIR_PATH=/var/lib/uvtool/libvirt/images/ocp


#VCenter Info
################################
##All GOVC variables must have export infront to work
export GOVC_INSECURE=1
VSPHERE_PORT_NUMBER=443
VSPHERE_RESOURCE_POOL=/${VSPHERE_DATACENTER}/host/${VSPHERE_CLUSTER}/Resources/
VSPHERE_ISO_IMAGE_BASE='Redhat/CoreOS/'
ESXi_HARDWARE_VERSION_VM_CREATE=6.5
VSPHERE_SYNC_TIME_WITH_HOST=true
VSPHERE_COREOS_GUEST_ID=coreos64Guest
VSPHERE_CLUSTER_OS_IMAGE=

#OpenShift Storage Info
###################################
OCS_OPERATOR_VERSION_4_9=4.9
OCS_OPERATOR_VERSION_4_10=4.9

IBM_OPENSHIFT_LOCAL_STORAGE_DEVICE_PATH_KVM=/dev/vdb
IBM_OPENSHIFT_LOCAL_BULK_STORAGE_DEVICE_PATH_KVM=/dev/vdc

IBM_OPENSHIFT_LOCAL_STORAGE_DEVICE_PATH_VSPHERE=/dev/sdb
IBM_OPENSHIFT_LOCAL_BULK_STORAGE_DEVICE_PATH_VSPHERE=/dev/sdc

IBM_OPENSHIFT_LOCAL_STORAGE_DEVICE_PATH_GCP=/dev/sdb
IBM_OPENSHIFT_LOCAL_BULK_STORAGE_DEVICE_PATH_GCP=/dev/sdc

IBM_OPENSHIFT_LOCAL_STORAGE_DEVICE_PATH_AZ=/dev/sdc
IBM_OPENSHIFT_LOCAL_BULK_STORAGE_DEVICE_PATH_AZ=/dev/sdd

IBM_OPENSHIFT_LOCAL_STORAGE_DEVICE_PATH_AWS=/dev/xvdf
IBM_OPENSHIFT_LOCAL_BULK_STORAGE_DEVICE_PATH_AWS=/dev/xvdg

IBM_OPENSHIFT_LOCAL_STORAGE_DEVICE_DISK2_NAME=data2
IBM_OPENSHIFT_LOCAL_STORAGE_DEVICE_DISK3_NAME=data3

OPEN_SHIFT_CONTAINTER_STORAGE_WORKER_NODE1=worker4.${OCP_HOST_NAME}
OPEN_SHIFT_CONTAINTER_STORAGE_WORKER_NODE2=worker5.${OCP_HOST_NAME}
OPEN_SHIFT_CONTAINTER_STORAGE_WORKER_NODE3=worker6.${OCP_HOST_NAME}


##NFS Info
################################
NFS_EXPORTS=/etc/exports
NFS_FILE_SYSTEM=/var/nfs/general

##Image Registry Info
################################
OCP_IMAGE_REGISTRY_STORAGE_CLASS=managed-nfs-storage
OCP_IMAGE_REGISTRY_STORAGE_SIZE=100G

#LDAP Base Info
################
LDAP_TYPE=IDS
LDAP_BASE_DN=dc=ibm,dc=com
LDAP_BIND_DN_IDS=cn=root
LDAP_BIND_DN_OPENLDAP=cn=admin,${LDAP_BASE_DN}
LDAP_PORT=389
if [[ -z "${MASTER_PASSWORD}" ]] ;then
    LDAP_PASSWORD=${LDAP_PASSWORD}
else
    LDAP_PASSWORD=${MASTER_PASSWORD}
fi
LDAP_INSTALL_ROOT=${IDS_HOME}
LDAP_INSTANCE_NAME=dsinst1
LDAP_INSTANCE_USER_ID=dsinst1
OPEN_LDAP_USER_OBJECTCLASS_1=person
OPEN_LDAP_USER_OBJECTCLASS_2=inetOrgPerson
IDS_USER_OBJECTCLASS_1=person
IDS_USER_OBJECTCLASS_2=ePerson


#Local Registory info
####################
AIRGAP_MODE=false
LOCAL_REGISTRY_PATH=${DATA_DIR}/registry
LOCAL_REGISTRY_ENABLED=false
LOCAL_OCP_REPOSITORY_NAME=openshift
OCP_LOCAL_REGISTRY_USERNAME=regadmin
OCP_LOCAL_REGISTRY_PASSWORD=password
LOCAL_REGISTRY_IP=127.0.0.1
LOCAL_REGISTRY_DNS_NAME=localhost
LOCAL_REGISTRY_CERTS_FOLDER=${DATA_DIR}/${PROJECT_NAME}/certs
LOCAL_REGISTRY_PORT=5000
LOCAL_REGISTRY_VERSION=2.7.1
OCP_AIRGAP_EXPORT=${DATA_DIR}/export/airgap
OCP_AIRGAP_IMPORT=${DATA_DIR}/import/airgap
OCP_AIRGAP_EXPORT_FREE_DISK_SIZE_NEEDED=20
LOCAL_REGISTRY_FREE_DISK_SIZE_NEEDED=20

#VSphere
####################
VSPHERE_NETWORKING_CLUSTERNETWORK_CIDR=10.128.0.0/14
VSPHERE_NETWORKING_CLUSTERNETWORK_HOSTPREFIX=23
VSPHERE_NETWORKING_NETWORKTYPE=OpenShiftSDN
VSPHERE_NETWORKING_SERVICE_NETWORK=172.30.0.0/16
VSPHERE_INSTALL_PUBLISH=External

#GCP
####################
GCP_API_ENABLE_MISSING_SERVICE=false
GCP_CREATE_MISSING_DNS_ZONE=false
GCP_NETWORKING_CLUSTER_NETWORK_CIDR=10.128.0.0/14
GCP_NETWORKING_CLUSTER_NETWORK_HOST_PREFIX=23
GCP_NETWORKING_MACHINE_NETWORK_CIDR=10.0.0.0/16
GCP_NETWORKING_MACHINE_NETWORK=OpenShiftSDN
GCP_NETWORKING_SERVICE_NETWORK=172.30.0.0/16
GCP_VPC_NETWORK=
GCP_CONTROL_PLANE_SUBNET=
GCP_COMPUTE_SUBNET=
GCP_INSTALL_PUBLISH=External


#Azure
####################
AZURE_NETWORKING_CLUSTER_NETWORK_CIDR=10.128.0.0/14
AZURE_NETWORKING_CLUSTER_NETWORK_HOST_PREFIX=23
AZURE_NETWORKING_MACHINE_NETWORK_CIDR=10.0.0.0/16
AZURE_NETWORKING_NETWORK_TYPE=OpenShiftSDN
AZURE_NETWORKING_SERVICE_NETWORK=172.30.0.0/16
AZURE_OUTBOUND_TYPE=Loadbalancer
AZURE_ZONE=
AZURE_NETWORK_RESOURCE_GROUP_NAME=
AZURE_VIRTUAL_NETWORK=
AZURE_CONTROL_PLANE_SUBNET=
AZURE_COMPUTE_SUBNET=
AZURE_CLOUD_NAME=AzurePublicCloud
AZURE_INSTALL_PUBLISH=External

#AWS
####################
AWS_NETWORKING_CLUSTER_NETWORK_CIDR=10.128.0.0/14
AWS_NETWORKING_CLUSTER_NETWORK_HOST_PREFIX=23
AWS_NETWORKING_MACHINE_NETWORK_CIDR=10.0.0.0/16
AWS_NETWORKING_NETWORK=OpenShiftSDN
AWS_NETWORKING_SERVICE_NETWORK=172.30.0.0/16
AWS_INSTALL_PUBLISH=External
AWS_AMI_ID=
AWS_SUBNET1=
AWS_SUBNET2=
AWS_SUBNET3=
AWS_SUBNET4=
AWS_SUBNET5=
AWS_SUBNET6=

#CloudPak Info
####################
IBM_CLOUD_CATALOG_SOURCE=ibm-operator-catalog
CASE_REPO_PATH=https://github.com/IBM/cloud-pak/raw/master/repo/case
CASE_REPO_OFFLINE_DIR=${TEMP_DIR}/case
CASE_REPO_OFFLINE_CPFS=${TEMP_DIR}/case-cpfs
#DB2 Info
####################
DB_ADMIN=db2inst1
DB2_PORT=50000

#Custom Resource Definition - Deployment Yaml
####################
CRD_DEBUG=false
CRD_NO_LOG=false
